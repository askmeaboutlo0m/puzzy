define("app",["exports","backend-service","aurelia-framework","jquery"],function(t,n,e,i){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function a(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;var s,r,u=o(i),c=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}();t.App=(s=(0,e.inject)(n.BackendService),s(r=function(){function t(n){a(this,t),this.title="hatGet",this.categories=null,this.history=null,this.itemInput="",this.categorySelect="",this.newCategoryInput="",this.backend=n;var e=/^\/W\/([^\/\.]+)/.exec(location.pathname);e&&(this.title=e[1].replace(/([^A-Z])([A-Z])/g,function(t,n,e){return n+" "+e}))}return t.prototype.showError=function(t,n){alert(t+": "+n.status+" "+n.statusText)},t.prototype.fetchItems=function(){var t=this;this.busify(),this.backend.getItems().then(function(n){t.unbusify();for(var e=Object.create(null),i=n,o=Array.isArray(i),a=0,i=o?i:i[Symbol.iterator]();;){var s;if(o){if(a>=i.length)break;s=i[a++]}else{if(a=i.next(),a.done)break;s=a.value}var r=s,u=r.category;e[u]=e[u]||[],e[u].push({id:r.id,name:r.name,orig:r.name,get buttonEnabled(){return this.name.trim()!==this.orig.trim()}})}t.categories=[];var c=Object.keys(e);c.sort();for(var d=c,l=Array.isArray(d),f=0,d=l?d:d[Symbol.iterator]();;){var m;if(l){if(f>=d.length)break;m=d[f++]}else{if(f=d.next(),f.done)break;m=f.value}var p=m;t.categories.push({name:p,items:e[p],print:"/W/"+t.backend.page+"/print/"+p,get buttonEnabled(){return this.input&&0!==this.input.trim().length}})}}).catch(function(n){t.unbusify(),t.showError("Error getting items from server",n)})},t.prototype.submitItem=function(){var t=this,n=this.categorySelect?this.categorySelect.trim():this.newCategoryInput.trim();(0,u.default)("#item-form").modal("hide"),this.busify(),this.backend.addItem(this.itemInput.trim(),n).then(function(n){t.itemInput="",t.newCategoryInput="",t.fetchItems()}).catch(function(n){t.unbusify(),t.showError("Error adding item",n),(0,u.default)("#item-form").modal("show")})},t.prototype.submitCategoryItem=function(t){var n=this;this.busify(),this.backend.addItem(t.input,t.name).then(function(e){t.input=null,n.fetchItems()}).catch(function(t){n.unbusify(),n.showError("Error adding item",t)})},t.prototype.submitEditItem=function(t){var n=this;this.busify(),this.backend.editItem(t).then(function(t){return n.fetchItems()}).catch(function(t){n.unbusify(),n.showError("Error modifying item",t)})},t.prototype.deleteItem=function(t){var n=this;this.busify(),this.backend.deleteItem(t).then(function(t){return n.fetchItems()}).catch(function(t){n.unbusify(),n.showError("Error deleting item",t)})},t.prototype.activate=function(){this.fetchItems()},t.prototype.showItemForm=function(){(0,u.default)("#item-form").modal("show")},t.prototype.showHistory=function(){var t=this;this.busify(),this.backend.getHistory().then(function(n){t.unbusify(),t.history=n.map(function(t){return t.date=new Date(1e3*t.timestamp).toLocaleString(),t.did=[null,"Added","Deleted","Restored","Updated","Categorized"][t.action],t}),(0,u.default)("#history").modal("show")}).catch(function(n){t.unbusify(),t.showError("Error getting history",n)})},t.prototype.busify=function(){(0,u.default)("#busy").modal("show"),document.title="‚è≥  W"+this.title+"?"},t.prototype.unbusify=function(){(0,u.default)("#busy").modal("hide"),document.title="W"+this.title+"?"},c(t,[{key:"buttonEnabled",get:function(){function t(t){return!t||0===t.trim().length}var n=!t(this.itemInput),e=!t(this.categorySelect),i=t(this.categorySelect)&&!t(this.newCategoryInput);return n&&(e||i)}}]),t}())||r)}),define("backend-service",["exports","aurelia-fetch-client","aurelia-framework","./environment"],function(t,n,e,i){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function a(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.BackendService=void 0;var s,r,u=o(i);t.BackendService=(s=(0,e.inject)(n.HttpClient),s(r=function(){function t(n){var e=this;a(this,t),this.page="hatGet";var i=/^\/W\/([^\/\.]+)/.exec(location.pathname);i&&(this.page=i[1]),this.httpClient=n,this.httpClient.configure(function(t){var n=u.default.testing?"localhost:3000":location.host;t.useStandardConfiguration().withBaseUrl("https://"+n+"/W/"+e.page+"/api/").withInterceptor({response:function(t){return t.json()}})})}return t.prototype.url=function t(){for(var n=arguments.length,e=Array(n),i=0;i<n;i++)e[i]=arguments[i];var t=e.map(function(t){return encodeURIComponent(t)}).join("/");return t+"?nocache="+(new Date).getTime()},t.prototype.getItems=function(){return this.httpClient.fetch(this.url("item"))},t.prototype.addItem=function(t,n){return this.httpClient.fetch(this.url("item"),{method:"POST",body:JSON.stringify({name:t,category:n})})},t.prototype.editItem=function(t){return this.httpClient.fetch(this.url("item",t.id),{method:"PATCH",body:JSON.stringify({name:t.name})})},t.prototype.deleteItem=function(t){return this.httpClient.fetch(this.url("item",t.id),{method:"DELETE"})},t.prototype.getHistory=function(){return this.httpClient.fetch(this.url("history"))},t}())||r)}),define("environment",["exports"],function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={debug:!1,testing:!1}}),define("main",["exports","./environment","bootstrap"],function(t,n){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}function i(t){t.use.standardConfiguration().feature("resources"),o.default.debug&&t.use.developmentLogging(),o.default.testing&&t.use.plugin("aurelia-testing"),t.start().then(function(){return t.setRoot()})}Object.defineProperty(t,"__esModule",{value:!0}),t.configure=i;var o=e(n);Promise.config({warnings:{wForgottenReturn:!1}})}),define("resources/index",["exports"],function(t){"use strict";function n(t){}Object.defineProperty(t,"__esModule",{value:!0}),t.configure=n}),define("text!whatget.css",["module"],function(t){t.exports="#top-buttons {\n    margin-top : 2em;\n}\n\n.add {\n    margin-top    : 5px;\n    margin-bottom : 10px;\n}\n\n.item {\n    margin-bottom : 10px;\n}\n\n.busy-text {\n    font-size  : 200%;\n    text-align : center;\n}\n"}),define("text!app.html",["module"],function(t){t.exports='<template>\n    <require from="bootstrap/css/bootstrap.css"></require>\n    <require from="./whatget.css"></require>\n\n    <div class="jumbotron">\n        <div class="container">\n            <h1>W${title}?</h1>\n        </div>\n        <div if.bind="categories" class="container">\n            <div id="top-buttons" class="btn-group" role="group">\n                <button class="btn btn-success" click.trigger="showItemForm()">\n                    <span class="fa fa-asterisk"></span> Add Item and Category\n                </button>\n                <button class="btn btn-primary" click.trigger="showHistory()">\n                    <span class="fa fa-history"></span> History\n                </button>\n            </div>\n        </div>\n    </div>\n\n    <div if.bind="!categories" class="container">\n        Loadering...  <span class="fa fa-meh-o fa-spin"></span>\n    </div>\n\n    <div if.bind="categories" class="container">\n        <div repeat.for="cat of categories">\n            <h2>\n                ${cat.name}\n                <a href.bind="cat.print" target="_blank">\n                    <span class="fa fa-print"></span>\n                </a>\n            </h2>\n            <form submit.trigger="submitCategoryItem(cat)">\n                <div class="input-group add">\n                    <input class="form-control" type="text" placeholder="New Item in ${cat.name}" value.bind="cat.input">\n                    <span class="input-group-btn">\n                        <button type="submit" class="btn btn-success" disabled.bind="!cat.buttonEnabled">\n                            <span class="fa fa-plus"></span>\n                        </button>\n                    </span>\n                </div>\n            </form>\n            <form repeat.for="item of cat.items" submit.trigger="submitEditItem(item)">\n                <div class="input-group item">\n                    <span class="input-group-btn">\n                        <button type="submit" class="btn btn-primary" disabled.bind="!item.buttonEnabled">\n                            <span class="fa fa-edit"></span>\n                        </button>\n                    </span>\n                    <input class="form-control" type="text" value.bind="item.name">\n                    <span class="input-group-btn">\n                        <button class="btn btn-danger" click.trigger="deleteItem(item)">\n                            <span class="fa fa-trash"></span>\n                        </button>\n                    </span>\n                </div>\n            </form>\n            <hr>\n        </div>\n\n        <div id="item-form" class="modal fade" tabindex="-1" role="dialog">\n            <form submit.trigger="submitItem()">\n                <div class="modal-dialog" role="document">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <button type="button" class="close" data-dismiss="modal">\n                                <span class="fa fa-times"></span>\n                            </button>\n                            <h4 class="modal-title">\n                                <span class="fa fa-asterisk"></span> Add Item and Category\n                            </h4>\n                        </div>\n                        <div class="modal-body">\n                            <div class="form-group">\n                                <input type="text" class="form-control" placeholder="Item" value.bind="itemInput">\n                            </div>\n                            <div class="form-group">\n                                <select class="form-control" value.bind="categorySelect">\n                                    <option repeat.for="cat of categories" value="${cat.name}">\n                                        ${cat.name}\n                                    </option>\n                                    <option value="">\n                                        New Category...\n                                    </option>\n                                </select>\n                            </div>\n                            <div if.bind="!categorySelect" class="form-group">\n                                <input type="text" class="form-control" placeholder="Category" value.bind="newCategoryInput">\n                            </div>\n                        </div>\n                        <div class="modal-footer">\n                            <button type="submit" class="btn btn-success" disabled.bind="!buttonEnabled">\n                                Submit\n                            </button>\n                            <button type="button" class="btn btn-default" data-dismiss="modal">\n                                Close\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            </form>\n        </div>\n\n        <div id="history" class="modal fade" tabindex="-1" role="dialog">\n            <div class="modal-dialog" role="document">\n                <div class="modal-content">\n                    <div class="modal-header">\n                        <button type="button" class="close" data-dismiss="modal">\n                            <span class="fa fa-times"></span>\n                        </button>\n                        <h4 class="modal-title">\n                            <span class="fa fa-history"></span> History\n                        </h4>\n                    </div>\n                    <div class="modal-body">\n                        <table class="table">\n                            <thead>\n                                <tr>\n                                    <th>Time</th>\n                                    <th>Category</th>\n                                    <th>Item</th>\n                                    <th>Action</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                <tr repeat.for="h of history">\n                                    <td>${h.date}</td>\n                                    <td>${h.category}</td>\n                                    <td>${h.name}</td>\n                                    <td>${h.did}</td>\n                                </tr>\n                            </tbody>\n                        </table>\n                    </div>\n                    <div class="modal-footer">\n                        <button type="button" class="btn btn-default" data-dismiss="modal">\n                            Close\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <div id="busy" class="modal" tabindex="-1" role="dialog">\n            <div class="modal-dialog" role="document">\n                <div class="modal-content">\n                    <div class="modal-body busy-text">\n                        <span class="fa fa-hourglass fa-spin"></span>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n'});
