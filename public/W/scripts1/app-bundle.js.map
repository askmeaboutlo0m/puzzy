{"version":3,"sources":["app.js","backend-service.js","environment.js","main.js","resources/index.js","/home/carsten/Development/whatget/src/app.html","/home/carsten/Development/whatget/src/whatget.css"],"names":["App","backendService","categories","history","itemInput","categorySelect","newCategoryInput","backend","showError","message","error","alert","fetchItems","busify","getItems","then","unbusify","cats","Object","create","items","item","c","category","push","id","name","orig","buttonEnabled","trim","keys","sort","key","input","length","catch","submitItem","modal","addItem","submitCategoryItem","cat","submitEditItem","editItem","deleteItem","activate","showItemForm","showHistory","getHistory","map","h","date","Date","timestamp","toLocaleString","did","action","empty","str","hasItem","hasCategory","hasNew","BackendService","httpClient","configure","host","testing","location","config","useStandardConfiguration","withBaseUrl","withInterceptor","response","json","url","path","encodeURIComponent","p","join","getTime","fetch","method","body","JSON","stringify","debug","Promise","warnings","wForgottenReturn","aurelia","use","standardConfiguration","feature","developmentLogging","plugin","start","setRoot"],"mappings":"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","file":"app-bundle.js","sourcesContent":["import {BackendService} from 'backend-service';\nimport {inject}         from 'aurelia-framework';\nimport $                from 'jquery';\n\n\n@inject(BackendService)\nexport class App {\n    categories       = null;\n    history          = null;\n    itemInput        = '';\n    categorySelect   = '';\n    newCategoryInput = '';\n\n    constructor(backendService) {\n        this.backend = backendService;\n    }\n\n\n    showError(message, error) {\n        alert(`${message}: ${error}`);\n    }\n\n\n    fetchItems() {\n        this.busify();\n        this.backend.getItems()\n            .then(items => {\n                this.unbusify();\n\n                let cats = Object.create(null);\n                for (let item of items) {\n                    let c = item.category;\n                    cats[c] = cats[c] || [];\n                    cats[c].push({\n                        id    : item.id,\n                        name  : item.name,\n                        orig  : item.name,\n                        get buttonEnabled() {\n                            return this.name.trim() !== this.orig.trim();\n                        },\n                    });\n                }\n\n                this.categories = [];\n                let keys = Object.keys(cats);\n                keys.sort();\n\n                for (let key of keys) {\n                    this.categories.push({\n                        name  : key,\n                        items : cats[key],\n                        get buttonEnabled() {\n                            return this.input && this.input.trim().length !== 0;\n                        },\n                    });\n                }\n            })\n            .catch(error => {\n                this.unbusify();\n                this.showError('Error getting items from server', error);\n            });\n    }\n\n\n    submitItem() {\n        let category = this.categorySelect\n                     ? this.categorySelect.trim()\n                     : this.newCategoryInput.trim();\n\n        $('#item-form').modal('hide');\n        this.busify();\n\n        this.backend.addItem(this.itemInput.trim(), category)\n            .then(item => {\n                this.itemInput        = '';\n                this.newCategoryInput = '';\n                this.fetchItems();\n            })\n            .catch(error => {\n                this.unbusify();\n                this.showError('Error adding item', error);\n                $('#item-form').modal('show');\n            });\n    }\n\n    submitCategoryItem(cat) {\n        this.busify();\n        this.backend.addItem(cat.input, cat.name)\n            .then(item => {\n                cat.input = null;\n                this.fetchItems();\n            })\n            .catch(error => {\n                this.unbusify();\n                this.showError('Error adding item', error);\n            });\n    }\n\n    submitEditItem(item) {\n        this.busify();\n        this.backend.editItem(item)\n            .then(res => this.fetchItems())\n            .catch(error => {\n                this.unbusify();\n                this.showError('Error modifying item', error);\n            });\n    }\n\n\n    deleteItem(item) {\n        this.busify();\n        this.backend.deleteItem(item)\n            .then(res => this.fetchItems())\n            .catch(error => {\n                this.unbusify();\n                this.showError('Error deleting item', error);\n            });\n    }\n\n\n    activate() {\n        this.fetchItems();\n    }\n\n    showItemForm() {\n        $('#item-form').modal('show');\n    }\n\n    get buttonEnabled() {\n        function empty(str) {\n            return !str || str.trim().length === 0;\n        }\n\n        let hasItem     = !empty(this.itemInput);\n        let hasCategory = !empty(this.categorySelect);\n        let hasNew      =  empty(this.categorySelect)\n                       && !empty(this.newCategoryInput);\n\n        return hasItem && (hasCategory || hasNew);\n    }\n\n\n    showHistory() {\n        this.busify();\n        this.backend.getHistory()\n            .then(history => {\n                this.unbusify();\n                this.history = history.map(h => {\n                    h.date = new Date(h.timestamp * 1000).toLocaleString();\n                    h.did  = [null, 'Added', 'Deleted', 'Restored',\n                              'Updated', 'Categorized'][h.action];\n                    return h;\n                });\n                $('#history').modal('show');\n            })\n            .catch(error => {\n                this.unbusify();\n                this.showError('Error getting history', error);\n            });\n    }\n\n\n    busify() {\n        $('#busy').modal('show');\n    }\n\n    unbusify() {\n        $('#busy').modal('hide');\n    }\n}\n","import {HttpClient} from 'aurelia-fetch-client';\nimport {inject}     from 'aurelia-framework';\nimport environment  from './environment';\n\n\n@inject(HttpClient)\nexport class BackendService {\n\n    constructor(httpClient) {\n        this.httpClient = httpClient;\n        this.httpClient.configure(config => {\n            let host = environment.testing ? 'localhost:3000' : location.host;\n            config\n                .useStandardConfiguration()\n                .withBaseUrl(`http://${host}/W/hatGet/api/`)\n                .withInterceptor({\n                    response(response) {\n                        return response.json();\n                    },\n                });\n        });\n    }\n\n    url(...path) {\n        let url = path.map(p => encodeURIComponent(p)).join(',');\n        return `${url}?nocache=${new Date().getTime()}`;\n    }\n\n    getItems() {\n        return this.httpClient.fetch(this.url('item'))\n    }\n\n    addItem(item, category) {\n        return this.httpClient.fetch(this.url('item'), {\n            method : 'POST',\n            body   : JSON.stringify({\n                name     : item,\n                category : category,\n            }),\n        });\n    }\n\n    editItem(item) {\n        return this.httpClient.fetch(this.url('item', item.id), {\n            method : 'PATCH',\n            body   : JSON.stringify({name : item.name}),\n        });\n    }\n\n    deleteItem(item) {\n        return this.httpClient.fetch(this.url('item', item.id), {\n            method : 'DELETE',\n        });\n    }\n\n    getHistory() {\n        return this.httpClient.fetch(this.url('history'));\n    }\n}\n","export default {\n  debug: true,\n  testing: true\n};\n","import environment from './environment';\nimport 'bootstrap';\n\n//Configure Bluebird Promises.\n//Note: You may want to use environment-specific configuration.\nPromise.config({\n    warnings: {\n        wForgottenReturn: false\n    }\n});\n\nexport function configure(aurelia) {\n    aurelia.use\n        .standardConfiguration()\n        .feature('resources');\n\n    if (environment.debug) {\n        aurelia.use.developmentLogging();\n    }\n\n    if (environment.testing) {\n        aurelia.use.plugin('aurelia-testing');\n    }\n\n    aurelia.start().then(() => aurelia.setRoot());\n}\n","export function configure(config) {\n  //config.globalResources([]);\n}\n",null,null],"sourceRoot":"../src"}